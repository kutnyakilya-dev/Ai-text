<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Gemini Audio Transcriber</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; background: #f4f4f4; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        button { background: #007bff; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; margin-top: 10px; }
        button:disabled { background: #ccc; }
        #output { background: #eee; padding: 15px; margin-top: 20px; min-height: 50px; white-space: pre-wrap; position: relative; }
        .copy-btn { background: #28a745; margin-left: 10px; }
    </style>
</head>
<body>

<div class="card">
    <h2>Транскрибация аудио</h2>
    <input type="file" id="audioInput" accept="audio/*">
    <button id="startBtn">Преобразовать в текст</button>
    
    <div id="output">Здесь появится текст...</div>
    <button id="copyBtn" class="copy-btn" style="display:none;">Копировать текст</button>
</div>

<script>
    const API_KEY = 'AIzaSyDdZxB-O_16W5uAbXMQ6lAtKGj3TUmS-nM';
    const startBtn = document.getElementById('startBtn');
    const copyBtn = document.getElementById('copyBtn');
    const output = document.getElementById('output');

    startBtn.onclick = async () => {
        const file = document.getElementById('audioInput').files[0];
        if (!file) return alert('Выберите файл!');

        startBtn.disabled = true;
        output.innerText = 'Обработка... подождите...';

        try {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async () => {
                const base64Data = reader.result.split(',')[1];
                
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: "Переведи это аудио в текст максимально точно." },
                                { inline_data: { mime_type: file.type, data: base64Data } }
                            ]
                        }]
                    })
                });

                const data = await response.json();
                const text = data.candidates[0].content.parts[0].text;
                output.innerText = text;
                copyBtn.style.display = 'inline-block';
            };
        } catch (err) {
            output.innerText = 'Ошибка: ' + err.message;
        } finally {
            startBtn.disabled = false;
        }
    };

    copyBtn.onclick = () => {
        navigator.clipboard.writeText(output.innerText);
        alert('Текст скопирован!');
    };
</script>

</body>
</html>